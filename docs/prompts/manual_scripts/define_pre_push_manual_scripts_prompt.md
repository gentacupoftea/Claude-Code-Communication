# mainブランチプッシュ前実行スクリプト定義・管理プロンプト

このプロンプトは、`main` ブランチへのプッシュ前に実行すべき手動スクリプト（テスト、ビルド、リンティング等）の詳細を定義・管理するためのものです。

## 目的

- プロジェクトの品質確保のために `main` ブランチへのプッシュ前に実行すべきスクリプトを明確に定義する
- 各スクリプトの目的、実行方法、期待される結果を統一的に管理する
- 開発チーム全体で共通理解を持ち、一貫した品質チェックプロセスを実現する

## スクリプト定義テンプレート

以下のテンプレートに従って、各スクリプトの詳細を定義してください。

### スクリプト名: [スクリプト名]

#### 1. 基本情報
- **目的・概要**: このスクリプトは何をするのか、なぜ必要なのか
- **実行タイミング**: mainブランチプッシュ前 / PR作成前 / その他
- **実行環境**: 必要なNode.jsバージョン、Pythonバージョン、OS要件など
- **重要度**: 必須 / 推奨 / オプション

#### 2. 実行コマンド
```bash
# 具体的なコマンドライン
```

#### 3. 期待される結果
- **成功時の出力**: 正常終了時に表示されるメッセージや状態
- **失敗時の挙動**: エラー発生時の対応方法
- **実行時間目安**: 通常の実行にかかる時間

#### 4. 前提条件・依存関係
- **実行前に必要な環境**: 環境変数、設定ファイル、データベース状態など
- **他のスクリプトとの依存関係**: 実行順序、並行実行の可否など
- **必要な権限**: 実行に必要なファイルアクセス権限など

#### 5. トラブルシューティング
- **よくあるエラーとその対処法**
- **デバッグ方法**
- **スキップ条件**: 特定の状況でスクリプトをスキップしても良い場合

#### 6. メタ情報
- **担当者**: スクリプト作成・メンテナンス担当者
- **最終更新日**: YYYY-MM-DD
- **バージョン**: スクリプトのバージョン番号
- **備考**: その他の重要な情報

---

## 現在定義されているスクリプト一覧

### 1. Frontend Build Script

#### 1. 基本情報
- **目的・概要**: フロントエンドコードのビルド処理を実行し、本番環境向けの最適化されたアセットを生成する
- **実行タイミング**: mainブランチプッシュ前必須
- **実行環境**: Node.js 22.x以上、npm
- **重要度**: 必須

#### 2. 実行コマンド
```bash
# フロントエンドプロジェクトディレクトリに移動してビルド実行
cd frontend-v2
npm install
npm run build
```

#### 3. 期待される結果
- **成功時の出力**: `dist/` ディレクトリに最適化されたファイルが生成される
- **失敗時の挙動**: TypeScriptエラー、ESLintエラー、ビルドエラーの詳細が表示される
- **実行時間目安**: 2-5分

#### 4. 前提条件・依存関係
- **実行前に必要な環境**: package.jsonの依存関係が最新であること
- **他のスクリプトとの依存関係**: TypeScript Type Check後に実行推奨
- **必要な権限**: frontend-v2ディレクトリへの書き込み権限

#### 5. トラブルシューティング
- **よくあるエラーとその対処法**: 
  - `npm ERR!` → `rm -rf node_modules && npm install`
  - TypeScriptエラー → `npm run typecheck` で詳細確認
- **デバッグ方法**: `npm run build --verbose` でより詳細なログ出力
- **スキップ条件**: フロントエンドコードに変更がない場合のみ

#### 6. メタ情報
- **担当者**: Frontend Team
- **最終更新日**: 2025-01-24
- **バージョン**: v1.0
- **備考**: Next.js 15.3.2 ベース

---

### 2. Backend Unit Tests

#### 1. 基本情報
- **目的・概要**: バックエンドAPIの単体テストを実行し、主要機能の動作確認を行う
- **実行タイミング**: mainブランチプッシュ前必須
- **実行環境**: Node.js 22.x以上、Jest
- **重要度**: 必須

#### 2. 実行コマンド
```bash
# バックエンドプロジェクトディレクトリで単体テスト実行
cd backend
npm test
```

#### 3. 期待される結果
- **成功時の出力**: 全テストケースの成功とカバレッジレポート
- **失敗時の挙動**: 失敗したテストケースの詳細とエラー内容表示
- **実行時間目安**: 3-10分

#### 4. 前提条件・依存関係
- **実行前に必要な環境**: テスト用データベース、環境変数設定
- **他のスクリプトとの依存関係**: 独立実行可能
- **必要な権限**: backend/test、backend/__tests__ ディレクトリアクセス権限

#### 5. トラブルシューティング
- **よくあるエラーとその対処法**:
  - DB接続エラー → 環境変数とテストDB状態確認
  - タイムアウトエラー → `jest.setTimeout` 値確認
- **デバッグ方法**: `npm test -- --verbose` で詳細出力
- **スキップ条件**: 緊急hotfixでバックエンドコードに変更がない場合

#### 6. メタ情報
- **担当者**: Backend Team
- **最終更新日**: 2025-01-24
- **バージョン**: v1.0
- **備考**: Jestベース、カバレッジ80%以上維持

---

### 3. Python Code Quality Check

#### 1. 基本情報
- **目的・概要**: Pythonコードのリンティング、型チェック、フォーマットチェックを実行
- **実行タイミング**: mainブランチプッシュ前推奨
- **実行環境**: Python 3.9以上、flake8, mypy, black
- **重要度**: 推奨

#### 2. 実行コマンド
```bash
# Pythonコード品質チェック実行
make lint
make format-check
make type-check
```

#### 3. 期待される結果
- **成功時の出力**: 各ツールからの成功メッセージ
- **失敗時の挙動**: コードスタイル違反、型エラーの詳細表示
- **実行時間目安**: 1-3分

#### 4. 前提条件・依存関係
- **実行前に必要な環境**: requirements-dev.txt の依存関係インストール済み
- **他のスクリプトとの依存関係**: Python単体テスト前に実行推奨
- **必要な権限**: Pythonソースディレクトリアクセス権限

#### 5. トラブルシューティング
- **よくあるエラーとその対処法**:
  - flake8エラー → コードスタイル修正
  - mypyエラー → 型アノテーション追加・修正
- **デバッグ方法**: 各ツールを個別実行して詳細確認
- **スキップ条件**: Pythonコードに変更がない場合

#### 6. メタ情報
- **担当者**: Backend Team
- **最終更新日**: 2025-01-24
- **バージョン**: v1.0
- **備考**: PEP8準拠、型安全性重視

---

### 4. TypeScript Type Check

#### 1. 基本情報
- **目的・概要**: TypeScriptコードの型チェックを実行し、型安全性を確保する
- **実行タイミング**: mainブランチプッシュ前必須
- **実行環境**: TypeScript 5.x以上
- **重要度**: 必須

#### 2. 実行コマンド
```bash
# フロントエンド型チェック
cd frontend-v2
npm run typecheck

# バックエンド型チェック（該当する場合）
cd backend
npm run typecheck
```

#### 3. 期待される結果
- **成功時の出力**: 型エラーなしの確認メッセージ
- **失敗時の挙動**: 型エラーの詳細とファイル位置表示
- **実行時間目安**: 30秒-2分

#### 4. 前提条件・依存関係
- **実行前に必要な環境**: tsconfig.json適切設定、型定義ファイル
- **他のスクリプトとの依存関係**: ビルド前に実行必須
- **必要な権限**: TypeScriptソースファイルアクセス権限

#### 5. トラブルシューティング
- **よくあるエラーとその対処法**:
  - 型定義不足 → `@types/*` パッケージ追加
  - import エラー → パス設定確認
- **デバッグ方法**: `tsc --noEmit --pretty` で見やすい出力
- **スキップ条件**: TypeScriptコードに変更がない場合

#### 6. メタ情報
- **担当者**: Frontend Team
- **最終更新日**: 2025-01-24
- **バージョン**: v1.0
- **備考**: strict モード有効

---

## スクリプト実行順序ガイドライン

推奨される実行順序:

1. **TypeScript Type Check** (最初に型安全性確認)
2. **Python Code Quality Check** (並行実行可能)
3. **Backend Unit Tests** (型チェック後)
4. **Frontend Build Script** (型チェック後)
5. **Integration Tests** (全体テスト、該当する場合)

## 更新履歴

- **2025-01-24**: 初回作成、基本的な4つのスクリプト定義を追加
- **将来**: プロジェクトの進行に応じてスクリプト追加・更新予定

---

**注意**: このドキュメントは定期的に更新されます。新しいスクリプトの追加や既存スクリプトの変更時は、必ずこのドキュメントも更新してください。