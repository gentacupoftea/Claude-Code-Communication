# Claude Code Self-Review Prompt: Task 45.6 - API Endpoint Modification

## 概要 (Overview)

こんにちは、Claude Code！

`Task 45.6`で、`multiLLM_system`のAPIが大幅に改修され、ワーカーを動的に選択できるようになりました。あなたの任務は、この重要なAPIの変更が、私たちの開発憲法、RESTfulの原則、そしてプロジェクトの要件に完全に準拠しているかを厳格にレビューすることです。

## レビュー対象ファイル (Files for Review)

1.  `multiLLM_system/api/server.py` (エンドポイントが変更・追加された部分)
2.  `multiLLM_system/api/API_ENDPOINTS_WORKER_TYPE.md` (新規作成されたドキュメント)

## レビューの観点 (Review Checklist)

**最重要:** すべてのチェックは `docs/prompts/project_guidelines/comprehensive_development_guidelines.md` の内容に厳密に従ってください。

### 1. API設計とエンドポイントのレビュー
- **[ ] RESTful原則:** 新しいエンドポイント (`/generate`, `/workers/types`) は、RESTfulの設計原則に従っているか？リソースの表現は適切か？
- **[ ] エンドポイントの責務:**
    - `/chat` と `/chat/stream` のロジックは明確か？ `worker_type` がある場合とない場合でのフォールバックロジックは正しく実装されているか？
    - `/generate` は、その名の通りシンプルな生成タスクに特化しているか？
- **[ ] Pydanticモデル:**
    - `ChatRequest` と `GenerationRequest` の型定義は適切か？ `Optional` やデフォルト値の使い方は正しいか？
    - モデルの命名は、その役割を正確に表しているか？

### 2. コード品質と堅牢性のレビュー (`server.py`)
- **[ ] エラーハンドリング:**
    - サポートされていない `worker_type` が指定された場合、ユーザーに分かりやすい4xx系のエラーを返せているか？
    - ワーカーの処理中に予期せぬエラーが発生した場合、5xx系のサーバーエラーとして適切に捕捉できているか？
- **[ ] 可読性と保守性:**
    - コードが複雑化していないか？特に `worker_type` の有無で分岐するロジックは、十分に読みやすく、将来の変更が容易な構造になっているか？
    - すべての新しいエンドポイントに、その機能とパラメータを説明するdocstringが記述されているか？
- **[ ] 一貫性:** プロジェクト内の他のAPIエンドポイントと、設計思想やコーディングスタイルが一貫しているか？

### 3. ドキュメントのレビュー (`API_ENDPOINTS_WORKER_TYPE.md`)
- **[ ] 正確性 (Accuracy):** ドキュメントに記載されているエンドポイント、リクエスト/レスポンスの例は、実際のコードの挙動と完全に一致しているか？
- **[ ] 明確さ (Clarity):**
    - 各エンドポイントの目的と使い方が、このドキュメントを初めて読む開発者にも明確に理解できるように書かれているか？
    - `worker_type` として何が指定できるのか、それぞれのワーカーが何をするのかが説明されているか？
- **[ ] 完全性 (Completeness):** 新しく追加・変更されたAPIの仕様がすべて網羅されているか？

## 出力形式 (Output Format)

レビューが完了したら、他のレビュープロンプトと同様に、以下の形式で**Pull Requestレビュー概要**を出力してください。

---

### Pull Request レビュー概要

**1. 総合評価 (Overall Assessment):**
（レビュー結果の総括を記述）

**2. 指摘事項と修正提案 (Issues and Suggestions):**
（問題点や改善提案を具体的にリストアップ。コードスニペットも提示すること。）

- **[ドキュメント改善/Doc] レスポンス例の追加:**
  - `API_ENDPOINTS_WORKER_TYPE.md` にはリクエスト例しかありません。成功時と失敗時のレスポンス例も追記することで、APIの仕様がより明確になります。
- **[改善提案/Suggestion] エンドポイントの整理:**
  - （もしロジックが重複している場合など）「`/chat`と`/generate`は責務が似ているため、将来的に統合を検討してはどうか」といった構造的な提案。

**3. 最終判定 (Final Verdict):**
（「修正後、PR作成可能」「PR作成可能」「要再設計」のいずれかで判定）

---

APIはシステムの顔です。ユーザーが最も触れる部分だからこそ、一切の妥協は許されません。徹底的なレビューをお願いします！ 