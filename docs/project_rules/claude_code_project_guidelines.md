# Claude Code プロジェクト別ガイドライン

このドキュメントは、このプロジェクトで Claude Code を使用する際の具体的な指示やルールをまとめたものです。

## 1. 全般的な注意事項

*   **mainブランチマージ時の確認:** mainブランチへのマージ・プッシュ時のみ、事前にげんたさんに確認を取ってください。通常の開発作業（フィーチャーブランチでの作業、ファイル作成・編集、コマンド実行など）については自律的に進めてください。
*   **プロジェクトルール同期確認:** mainブランチへのマージ・プッシュ前には、必ず `./scripts/ensure_project_rules_sync.sh` を実行してプロジェクトルール関連ファイルの同期状況を確認してください。このスクリプトはスキップ不可の必須チェックです。
*   **ファイル構造の厳守:** プロンプトで指示されたディレクトリおよびファイル構造を正確に守って開発を行ってください。不明な点があれば、作業前に確認してください。

## 2. ブランチ戦略

Pull Request作成時のブランチ戦略は、プロジェクトルートにある `my-cursor-rule.mdc` の「2. Pull Request指示プロンプト作成ルール」に従ってください。主なポイントは以下の通りです。

*   ソースブランチ: `main` ブランチから都度新しいフィーチャーブランチを作成 (例: `feature/機能名`, `fix/バグ内容`)。
*   ターゲットブランチ: 原則として `main` ブランチ。

## 3. タスクリストの場所

プロジェクトのタスクリストは以下の場所にあります。Task Master AI (MCP) と連携してタスク管理を行ってください。

*   **タスクファイル:** `.taskmaster/tasks/tasks.json`

## 4. プロンプトの場所

Claude Code 向けの各種指示プロンプトは、主に以下のディレクトリに格納されています。

*   **Pull Request関連プロンプト:** `docs/prompts/pull_requests/`
*   **セルフレビュー指示プロンプト:** プロジェクトルート (例: `claude_code_self_review_prompt_TaskXX_タスク概要.md`)
*   **その他プロジェクトガイドライン関連プロンプト:** `docs/prompts/project_guidelines/`

## 5. 必須実行スクリプト

### 5.1 プロジェクトルールファイル同期確認スクリプト

**目的**: mainブランチへのマージ・プッシュ前にプロジェクトルール関連ファイルの同期状況を確認する

**実行タイミング**: mainブランチへのマージ・プッシュ前（必須）

**実行方法**:
```bash
./scripts/ensure_project_rules_sync.sh
```

**対象ファイル**:
- `my-cursor-rule.mdc` - 統合プロジェクトルールファイル
- `docs/project_rules/` - プロジェクト基本ルール
- `docs/prompts/` - 各種プロンプト定義

**重要**: このスクリプトは **スキップ不可** です。失敗した場合は、表示される対応手順に従ってプロジェクトルールファイルをコミットしてから再実行してください。

**詳細仕様**: `docs/prompts/manual_scripts/define_pre_push_manual_scripts_prompt.md` を参照

## 6. 【最重要】`main` ブランチにおける禁止事項と基本原則

`main` ブランチは、常に安定し、デプロイ可能な状態を維持することを目指す、当プロジェクトの生命線です。
あなたが `main` ブランチに対して直接作業を行う際には、以下の事項を絶対に遵守してください。

### 禁止事項 (main ブランチ上での作業)

*   **安易なファイル/ディレクトリの削除:**
    *   たとえ一時的に不要だと感じても、自己判断でファイルやディレクトリを `main` ブランチから削除する行為は**原則禁止**です。
    *   ファイル構成の変更や大規模なクリーンアップが必要な場合は、必ず事前に私（げんた）に提案し、承認を得てください。その際も、専用のフィーチャーブランチで作業し、十分なレビューを経てから `main` にマージします。
*   **`tsconfig.json` やリンター設定等の広範囲な `exclude`/`ignore` 設定の安易な変更:**
    *   エラー数を表面上減らすためだけに、型チェックやリンターの対象から広範囲なファイルやディレクトリを除外するような設定変更は**原則禁止**です。
    *   これらの設定ファイルを変更する場合は、その影響範囲を十分に理解し、最小限の変更に留め、かつ変更理由と影響について必ず私（げんた）に事前相談してください。
*   **未検証・未テストのコードの直接コミット:**
    *   十分に動作確認やテストが行われていないコードを、安易に `main` ブランチに直接コミットしないでください。
*   **大規模リファクタリングの独断実行:**
    *   影響範囲の広い大規模なリファクタリングを、相談なく `main` ブランチで直接開始しないでください。必ずフィーチャーブランチで段階的に行い、レビューを受けてください。

### 基本原則 (main ブランチ上での作業)

*   **問題解決の基本姿勢:**
    *   エラーや問題（型エラー、リントエラー、テスト失敗など）に直面した場合、その場しのぎの対応（エラー抑制、広範囲な除外など）に頼るのではなく、**エラーメッセージを正確に理解し、根本原因を特定し、一つ一つ丁寧かつ着実に問題を修正・解決する**ことを常に心がけてください。
*   **変更は最小限に:**
    *   `main` ブランチへの直接的な変更は、常に最小限の範囲に留めるように意識してください。
*   **事前相談の徹底:**
    *   少しでも判断に迷う作業、影響範囲が広い作業、あるいは上記の禁止事項に抵触する可能性がある作業を行う場合は、**コードを書き始める前に必ず私（げんた）に相談し、指示を仰いでください。**
*   **コミット前の最終確認:**
    *   `git status` や `git diff` を用いて、コミットしようとしている変更内容が本当に意図したものであり、余計な変更や削除が含まれていないかを必ず確認してください。

これらのルールは、`main` ブランチの品質と安定性を守り、プロジェクト全体の健全な進行を担保するために不可欠です。あなたの深い理解と徹底した遵守を強く求めます。

---

これらのガイドラインと `my-cursor-rule.mdc` の指示に従って、効率的かつ正確な開発を心がけてください。