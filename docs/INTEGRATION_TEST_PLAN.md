# Conea 統合テスト計画書

## 1. はじめに

### 1.1 目的

本計画書は、Coneaプロジェクト（旧Shopify-MCP-Server）の統合テストの方針、範囲、手順を定義するものです。統合テストはフェーズ2リネーム作業完了後（期限：6/15）のシステム全体の品質を確保するために重要です。

### 1.2 参照資料

- Conea アーキテクチャ設計書
- API仕様書
- コンポーネント間インターフェース定義
- テスト標準規約

## 2. テスト環境

### 2.1 ハードウェア/ソフトウェア環境

- **テスト環境**: ステージング環境
- **データベース**: PostgreSQL 14.x
- **アプリケーションサーバー**: Cloud Run
- **フロントエンド**: Firebase Hosting

### 2.2 テストデータ

統合テストには以下のテストデータを使用します：

- ショップ情報テストデータ
- 製品カタログテストデータ
- ユーザーアカウントテストデータ
- API認証情報テストデータ

## 3. テスト対象機能

### 3.1 パッケージリネーム

- 旧パッケージ名（shopify-mcp-server）から新パッケージ名（conea）への移行
- インポートパスの一貫性
- 後方互換性レイヤー
- 設定ファイル参照の更新

### 3.2 認証システム

- ユーザー認証（ログイン/ログアウト）
- JWTトークン生成と検証
- ロールベースアクセス制御（管理者/マネージャー/ユーザー）
- API認証

### 3.3 AIプロバイダー連携

- OpenAIプロバイダー連携
- Claudeプロバイダー連携
- Geminiプロバイダー連携
- プロバイダーフェイルオーバー
- トークン制限管理

### 3.4 データ可視化コンポーネント

- Chart.js連携
- チャートコマンド解析
- 各種チャートタイプのレンダリング
- チャート設定オプション

### 3.5 APIエンドポイント

- RESTfulエンドポイント
- GraphQLエンドポイント
- MCPツールエンドポイント
- Webhookエンドポイント

### 3.6 コンポーネント間連携

- フロントエンド - バックエンド連携
- バックエンド - データベース連携
- バックエンド - 外部APIサービス連携

## 4. テスト戦略

### 4.1 テストアプローチ

統合テストは、以下のアプローチで実施します：

1. **コンポーネントレベルテスト**: 各コンポーネント間の連携をテスト
2. **E2Eテスト**: システム全体のエンドツーエンドフローをテスト
3. **パフォーマンステスト**: 負荷下での動作を検証
4. **セキュリティテスト**: セキュリティ関連機能の検証

### 4.2 テスト自動化

テストの効率化と再現性確保のため、以下のテストを自動化します：

- ユニットテスト（pytest）
- API統合テスト（pytest + requests）
- E2Eテスト（Cypress）
- 負荷テスト（Locust）

### 4.3 テスト優先度

テストは以下の優先度に基づいて実行します：

1. **最優先**: コアシステム機能、セキュリティ関連機能
2. **高優先**: ビジネスクリティカルな機能
3. **中優先**: 一般機能
4. **低優先**: 補助的機能

## 5. テストケース

### 5.1 パッケージリネームテスト

| ID | テスト内容 | 優先度 | 前提条件 | 期待結果 |
|----|------------|--------|----------|----------|
| RN-01 | 新パッケージ名のインポート | 最優先 | リネーム実装完了 | インポートエラーなく動作 |
| RN-02 | 旧パッケージ名のインポート（互換性） | 最優先 | 互換性レイヤー実装 | 非推奨警告と共に動作 |
| RN-03 | 設定ファイルでの参照更新 | 高優先 | 設定ファイル更新完了 | 新パッケージ名での設定適用 |
| RN-04 | 環境変数の互換性 | 高優先 | 互換性レイヤー実装 | 旧変数名でも正常動作 |

### 5.2 認証システムテスト

| ID | テスト内容 | 優先度 | 前提条件 | 期待結果 |
|----|------------|--------|----------|----------|
| AU-01 | ユーザーログイン | 最優先 | テストユーザー作成済 | 認証成功とトークン発行 |
| AU-02 | 不正ログイン試行 | 最優先 | - | 認証失敗と適切なエラー |
| AU-03 | JWTトークン検証 | 最優先 | 有効なトークン | トークン検証成功 |
| AU-04 | ロールベースアクセス制御 | 高優先 | 異なるロールのユーザー | 権限に応じたアクセス制御 |

### 5.3 AIプロバイダー連携テスト

| ID | テスト内容 | 優先度 | 前提条件 | 期待結果 |
|----|------------|--------|----------|----------|
| AI-01 | OpenAIプロバイダー接続 | 高優先 | APIキー設定 | 正常な応答取得 |
| AI-02 | Claudeプロバイダー接続 | 高優先 | APIキー設定 | 正常な応答取得 |
| AI-03 | Geminiプロバイダー接続 | 高優先 | APIキー設定 | 正常な応答取得 |
| AI-04 | プロバイダーフェイルオーバー | 中優先 | 一部APIエラー設定 | 代替プロバイダーへの切替 |
| AI-05 | トークン制限管理 | 中優先 | 制限設定 | 制限に従った動作 |

### 5.4 データ可視化テスト

| ID | テスト内容 | 優先度 | 前提条件 | 期待結果 |
|----|------------|--------|----------|----------|
| CH-01 | 棒グラフ生成 | 中優先 | チャートデータ | 正確なレンダリング |
| CH-02 | 折れ線グラフ生成 | 中優先 | チャートデータ | 正確なレンダリング |
| CH-03 | 円グラフ生成 | 中優先 | チャートデータ | 正確なレンダリング |
| CH-04 | チャートコマンド解析 | 高優先 | コマンド構文 | 正確な解析結果 |
| CH-05 | チャート設定オプション | 中優先 | 設定オプション | 正確な適用結果 |

### 5.5 APIエンドポイントテスト

| ID | テスト内容 | 優先度 | 前提条件 | 期待結果 |
|----|------------|--------|----------|----------|
| API-01 | ヘルスチェックエンドポイント | 最優先 | - | 正常応答 |
| API-02 | GraphQLクエリ実行 | 高優先 | 認証済み | クエリ結果取得 |
| API-03 | MCPツール呼び出し | 高優先 | 認証済み | ツール実行結果 |
| API-04 | Webhook受信処理 | 中優先 | Webhookデータ | 正常処理完了 |

## 6. テスト実行手順

### 6.1 テスト環境準備

```bash
# リポジトリのクローン
git clone https://github.com/conea/conea.git
cd conea

# テスト環境準備
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pip install -r requirements-dev.txt
```

### 6.2 パッケージリネームテスト

```bash
# リネーム検証テストの実行
pytest tests/rename/test_package_rename.py -v
```

### 6.3 認証システムテスト

```bash
# 認証テストの実行
pytest tests/auth/ -v
```

### 6.4 AIプロバイダー連携テスト

```bash
# AIプロバイダーテストの実行
pytest tests/ai/test_provider_integration.py -v
```

### 6.5 データ可視化テスト

```bash
# チャートテストの実行
pytest tests/charts/test_chart_rendering.py -v
```

### 6.6 APIエンドポイントテスト

```bash
# APIエンドポイントテストの実行
pytest tests/api/ -v
```

### 6.7 コンポーネント間連携テスト

```bash
# 統合テストの実行
pytest tests/integration/ -v
```

### 6.8 E2Eテスト

```bash
# E2Eテストの実行
cd frontend
npm run test:e2e
```

### 6.9 パフォーマンステスト

```bash
# 負荷テストの実行
python -m locust -f tests/performance/locustfile.py
```

## 7. 結果管理

### 7.1 テスト結果の記録

テスト結果は以下の形式で記録します：

- テストレポート（HTML形式）
- エラーログ
- スクリーンショット（UI関連テスト）
- パフォーマンス計測データ

### 7.2 バグトラッキング

テスト中に発見された問題は、以下の情報と共にイシュートラッカーに登録します：

- 発見日時
- 発見者
- テストケースID
- 問題の説明
- 再現手順
- 期待される動作
- 実際の動作
- スクリーンショットまたはログ

### 7.3 テスト完了基準

統合テストは以下の基準を満たした時点で完了とします：

1. すべての最優先テストケースが成功
2. 高優先テストケースの95%以上が成功
3. 中優先テストケースの90%以上が成功
4. 未解決のクリティカルバグがない
5. パフォーマンス基準を満たしている

## 8. スケジュール

| フェーズ | 開始日 | 終了日 | 担当者 |
|---------|-------|-------|-------|
| テスト環境準備 | 2025/5/22 | 2025/5/22 | インフラチーム |
| パッケージリネームテスト | 2025/5/23 | 2025/5/23 | QAチーム |
| 認証システムテスト | 2025/5/23 | 2025/5/24 | QAチーム |
| AIプロバイダー連携テスト | 2025/5/24 | 2025/5/25 | QAチーム |
| データ可視化テスト | 2025/5/24 | 2025/5/25 | QAチーム |
| APIエンドポイントテスト | 2025/5/25 | 2025/5/26 | QAチーム |
| E2Eテスト | 2025/5/26 | 2025/5/27 | QAチーム |
| パフォーマンステスト | 2025/5/26 | 2025/5/27 | インフラチーム |
| バグ修正 | 2025/5/27 | 2025/5/28 | 開発チーム |
| 再テスト | 2025/5/28 | 2025/5/28 | QAチーム |

## 9. 担当者とリソース

### 9.1 テストチーム

- QAリード: [氏名]
- QAエンジニア: [氏名], [氏名]
- 開発サポート: [氏名], [氏名]
- インフラサポート: [氏名]

### 9.2 必要なリソース

- テスト環境アクセス権限
- APIキー（OpenAI, Claude, Gemini）
- テストデータセット
- モニタリングツールアクセス

## 10. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|-------|--------|----------|------|
| テスト環境の不安定 | 高 | 中 | バックアップ環境の準備 |
| 外部APIの応答遅延 | 中 | 高 | モック応答の準備 |
| テストデータ不足 | 中 | 低 | 事前データ生成ツールの準備 |
| 自動テスト失敗 | 高 | 中 | 手動テスト手順の準備 |
| リソース不足 | 高 | 低 | クラウドリソースの柔軟な拡張 |

## 11. 承認

| 役割 | 氏名 | 承認日 |
|------|------|--------|
| QAリード | | |
| 開発リード | | |
| プロジェクトマネージャー | | |

---

作成日: 2025年5月21日  
最終更新日: 2025年5月21日  
文書番号: CONEA-TEST-PLAN-001