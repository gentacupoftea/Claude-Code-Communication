# Cloud SQL バックアップと復旧システム

Conea プロジェクトにおける Cloud SQL データベースのバックアップと復旧のドキュメントやスクリプトをまとめたものです。

## 🔄 バックアップシステムの概要

このシステムは以下の機能を提供します：

- 自動日次バックアップの構成
- ポイントインタイムリカバリ機能の有効化
- バックアップ保持期間の設定
- 手動バックアップ作成機能
- 復旧手順のガイドライン

## 📚 ドキュメント一覧

- [Cloud SQL バックアップ戦略](./CLOUD_SQL_BACKUP_STRATEGY.md) - 基本的なバックアップ戦略とポリシー
- [Cloud SQL 高度なバックアップ構成](./CLOUD_SQL_ADVANCED_BACKUP.md) - 環境別の詳細設定と最適化
- [Cloud SQL 復旧手順](./CLOUD_SQL_RECOVERY_PROCEDURE.md) - 詳細な復旧手順とチェックリスト

## 🛠️ スクリプト

- `/scripts/configure_cloudsql_backup.sh` - バックアップ設定の対話型構成スクリプト

## 🚀 使用方法

### バックアップ設定の構成

バックアップを設定するには以下のコマンドを実行します：

```bash
cd /Users/mourigenta/shopify-mcp-server
./scripts/configure_cloudsql_backup.sh
```

このスクリプトは対話式で以下の設定を行います：

- バックアップ開始時間
- バックアップの保持期間
- トランザクションログの保持期間
- ポイントインタイムリカバリの有効化
- バックアップの保存場所

### 手動バックアップの作成

重要な変更前に手動バックアップを作成するには：

```bash
# .envファイルから環境変数を読み込み
source .env

# 手動バックアップの作成
gcloud sql backups create --instance=$DB_INSTANCE_NAME --description="重要な変更前のバックアップ"
```

### バックアップの確認

現在のバックアップ状態を確認するには：

```bash
# .envファイルから環境変数を読み込み
source .env

# バックアップ一覧の表示
gcloud sql backups list --instance=$DB_INSTANCE_NAME
```

## 📅 バックアップスケジュール

推奨バックアップスケジュール：

| 環境 | 自動バックアップ | 保持期間 | 手動バックアップ |
|------|--------------|---------|--------------|
| 開発 | 毎日 UTC 15:00 | 3日間 | 重要な変更前 |
| ステージング | 毎日 UTC 16:00 | 7日間 | スプリント終了時 |
| 本番 | 毎日 UTC 17:00 | 14-30日間 | 月次＋重要な変更前 |

## 🔒 セキュリティ考慮事項

- バックアップへのアクセスは厳格に制限されています
- リストア操作には特別な権限が必要です
- バックアップデータは保存時に暗号化されています
- 一部のバックアップはクロスリージョンで保持されています

## ⚠️ 注意事項

- バックアップ操作はデータベースパフォーマンスに影響を与える可能性があります
- 大規模なデータベースのバックアップと復元には長時間かかることがあります
- 復元操作を行う前に必ず影響範囲を評価してください
- 定期的にバックアップからの復元テストを実施してください

## 🔍 トラブルシューティング

バックアップや復元に問題がある場合：

1. Cloud SQLログを確認
2. GCPステータスダッシュボードでサービス状態を確認
3. インスタンスの接続可能性を確認
4. 権限とIAMロールを確認
5. サポートに問い合わせる場合はエラーメッセージとログを提供

## 📞 サポート

バックアップシステムに関する質問や問題がある場合は、以下にお問い合わせください：

- プロジェクト管理者: admin@conea.com
- クラウドインフラチーム: cloud-infra@conea.com