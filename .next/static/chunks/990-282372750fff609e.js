"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[990],{1266:(e,t,s)=>{s.d(t,{N:()=>N});var a=s(3365),n=s(1521),i=s(6700),r=s(7020),o=s(4840),l=s(2285),d=s(7879),c=s(9912),m=s(6296),p=s(3060),h=s(3697),u=s(1647),x=s(2912),g=s(7832),y=s(1666),f=s(7521),w=s(3236),b=s(627);let v=e=>{let{isCollapsed:t=!1,onToggleCollapse:s}=e,{user:v,logout:j}=(0,w.A)(),N=(0,b.useRouter)(),[k,C]=(0,n.useState)(""),[A,T]=(0,n.useState)([]),[M,P]=(0,n.useState)(new Set),[S,D]=(0,n.useState)(null),[_,E]=(0,n.useState)(null);(0,n.useEffect)(()=>{T([{id:"1",name:"AIエージェントチーム作成プロジェクト",type:"folder",createdAt:"2025-05-20",updatedAt:"2025-05-31",children:[{id:"1-1",name:"１週間の行動計画",type:"chat",parentId:"1",createdAt:"2025-05-25",updatedAt:"2025-05-31"},{id:"1-2",name:"BigQueryクレンジング",type:"chat",parentId:"1",createdAt:"2025-05-28",updatedAt:"2025-05-30"}]},{id:"2",name:"Gmail自動返信BOT",type:"project",createdAt:"2025-05-15",updatedAt:"2025-05-29"},{id:"3",name:"Shopify Login Navigation Fix",type:"chat",createdAt:"2025-05-31",updatedAt:"2025-05-31",metadata:{tags:["urgent","bug-fix"]}}])},[]);let B=e=>{P(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},I=e=>{D(e.id),"chat"===e.type||"project"===e.type?N.push("/projects/".concat(e.id)):"folder"===e.type&&B(e.id)},R=(e,t)=>{e.preventDefault(),E({x:e.clientX,y:e.clientY,itemId:t})},L=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=M.has(e.id),m=S===e.id,p=e.children&&e.children.length>0;return(0,a.jsxs)("div",{children:[(0,a.jsxs)(i.P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"\n            group flex items-center px-3 py-2 rounded-lg cursor-pointer\n            transition-all duration-200\n            ".concat(m?"bg-[#1ABC9C]/20 text-[#1ABC9C]":"hover:bg-white/5 text-gray-300 hover:text-white","\n          "),style:{paddingLeft:"".concat(12+16*s,"px")},onClick:()=>I(e),onContextMenu:t=>R(t,e.id),children:[(0,a.jsxs)("div",{className:"flex items-center mr-2",children:["folder"===e.type&&p&&(0,a.jsx)(i.P.div,{animate:{rotate:90*!!n},transition:{duration:.2},className:"mr-1",children:(0,a.jsx)(o.A,{className:"w-4 h-4"})}),"chat"===e.type&&(0,a.jsx)(l.A,{className:"w-4 h-4"}),"project"===e.type&&(0,a.jsx)(d.A,{className:"w-4 h-4"}),"folder"===e.type&&!p&&(0,a.jsx)(d.A,{className:"w-4 h-4"})]}),!t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"flex-1 truncate text-sm",children:e.name}),(0,a.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),R(t,e.id)},className:"p-1 hover:bg-white/10 rounded",children:(0,a.jsx)(c.A,{className:"w-4 h-4"})})})]})]}),p&&n&&!t&&(0,a.jsx)(r.N,{children:(0,a.jsx)(i.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:e.children.map(e=>L(e,s+1))})})]},e.id)},G=A.filter(e=>e.name.toLowerCase().includes(k.toLowerCase()));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.P.aside,{animate:{width:t?64:280,transform:window.innerWidth<768&&!t?"translateX(0)":void 0},transition:{duration:.3},className:"bg-gray-900/50 backdrop-blur-lg border-r border-white/10 h-full flex flex-col md:relative fixed md:translate-x-0 z-40",style:{transform:window.innerWidth<768&&!t?"translateX(-100%)":void 0},children:[(0,a.jsx)("div",{className:"p-4 border-b border-white/10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(i.P.h2,{animate:{opacity:+!t},className:"text-lg font-semibold text-white",children:"プロジェクト"}),(0,a.jsx)("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:(0,a.jsx)(i.P.div,{animate:{rotate:180*!!t},transition:{duration:.3},children:(0,a.jsx)(o.A,{className:"w-5 h-5 text-gray-400"})})})]})}),!t&&(0,a.jsx)("div",{className:"p-4 border-b border-white/10",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(m.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"検索...",value:k,onChange:e=>C(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg text-sm text-white placeholder-gray-400 focus:outline-none focus:border-[#1ABC9C] transition-colors"})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-2 py-4",children:[!t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>N.push("/dashboard"),className:"w-full flex items-center px-3 py-2 mb-4 bg-[#1ABC9C] hover:bg-[#16A085] rounded-lg text-white font-medium transition-colors",children:[(0,a.jsx)(p.A,{className:"w-4 h-4 mr-2"}),"新規プロジェクト"]}),(0,a.jsx)("div",{className:"space-y-1",children:G.map(e=>L(e))}),0===G.length&&(0,a.jsx)("p",{className:"text-center text-gray-400 text-sm mt-8",children:"プロジェクトが見つかりません"})]}),t&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{onClick:()=>N.push("/dashboard"),className:"w-full p-3 hover:bg-white/10 rounded-lg transition-colors",title:"新規プロジェクト",children:(0,a.jsx)(p.A,{className:"w-5 h-5 text-[#1ABC9C] mx-auto"})}),A.slice(0,5).map(e=>(0,a.jsxs)("button",{onClick:()=>I(e),className:"w-full p-3 hover:bg-white/10 rounded-lg transition-colors",title:e.name,children:["chat"===e.type&&(0,a.jsx)(l.A,{className:"w-5 h-5 text-gray-400 mx-auto"}),"project"===e.type&&(0,a.jsx)(d.A,{className:"w-5 h-5 text-gray-400 mx-auto"}),"folder"===e.type&&(0,a.jsx)(d.A,{className:"w-5 h-5 text-gray-400 mx-auto"})]},e.id))]})]}),(0,a.jsx)("div",{className:"border-t border-white/10 p-4",children:t?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{onClick:()=>N.push("/settings"),className:"w-full p-3 hover:bg-white/10 rounded-lg transition-colors",title:"設定",children:(0,a.jsx)(h.A,{className:"w-5 h-5 text-gray-400 mx-auto"})}),(0,a.jsx)("button",{onClick:j,className:"w-full p-3 hover:bg-white/10 rounded-lg transition-colors",title:"ログアウト","data-testid":"logout-button",children:(0,a.jsx)(u.A,{className:"w-5 h-5 text-gray-400 mx-auto"})})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("button",{onClick:()=>N.push("/settings"),className:"w-full flex items-center px-3 py-2 text-gray-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors",children:[(0,a.jsx)(h.A,{className:"w-4 h-4 mr-2"}),"設定"]}),(0,a.jsxs)("button",{onClick:j,className:"w-full flex items-center px-3 py-2 text-gray-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors","data-testid":"logout-button",children:[(0,a.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"ログアウト"]})]})})]}),(0,a.jsx)(r.N,{children:_&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>E(null)}),(0,a.jsxs)(i.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed z-50 bg-gray-800 border border-white/10 rounded-lg shadow-xl p-1",style:{left:_.x,top:_.y},children:[(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-white/10 rounded",children:[(0,a.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"名前を変更"]}),(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-white/10 rounded",children:[(0,a.jsx)(g.A,{className:"w-4 h-4 mr-2"}),"お気に入りに追加"]}),(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-white/10 rounded",children:[(0,a.jsx)(y.A,{className:"w-4 h-4 mr-2"}),"アーカイブ"]}),(0,a.jsx)("div",{className:"my-1 border-t border-white/10"}),(0,a.jsxs)("button",{className:"w-full flex items-center px-3 py-2 text-sm text-red-400 hover:text-red-300 hover:bg-white/10 rounded",children:[(0,a.jsx)(f.A,{className:"w-4 h-4 mr-2"}),"削除"]})]})]})})]})};var j=s(8796);let N=e=>{let{children:t}=e,[s,r]=(0,n.useState)(!1);return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white overflow-hidden relative flex",children:[(0,a.jsx)(j._V,{}),(0,a.jsx)(j.ul,{count:30}),(0,a.jsx)(v,{isCollapsed:s,onToggleCollapse:()=>r(!s)}),(0,a.jsx)(i.P.main,{animate:{marginLeft:0},transition:{duration:.3},className:"flex-1 relative z-10",children:t})]})}},3869:(e,t,s)=>{s.d(t,{C:()=>y});var a=s(3365),n=s(1521),i=s(7020),r=s(6700),o=s(1917),l=s(5753),d=s(7931),c=s(3678),m=s(6224),p=s(6296),h=s(3697),u=s(3850);class x{static getInstance(){return x.instance||(x.instance=new x),x.instance}initializeProviders(){this.providers=[{id:"openai",name:"OpenAI",displayName:"OpenAI",description:"高品質な自然言語処理モデル",models:[{id:"gpt-4o",name:"GPT-4o",displayName:"GPT-4o",provider:"openai",contextLength:128e3,maxOutputTokens:4096,isMultimodal:!0,supportedLanguages:["ja","en","zh","ko","es","fr","de"],strengths:["推論","創作","コーディング","分析"],useCase:["チャット","コーディング","文書作成","分析"],pricing:{inputTokenPrice:5e-6,outputTokenPrice:15e-6},isEnabled:!0,description:"最新のGPT-4オムニモデル"},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",displayName:"GPT-3.5 Turbo",provider:"openai",contextLength:16384,maxOutputTokens:4096,isMultimodal:!1,supportedLanguages:["ja","en","zh","ko","es","fr"],strengths:["チャット","要約","翻訳"],useCase:["チャット","要約","Q&A"],pricing:{inputTokenPrice:5e-7,outputTokenPrice:15e-7},isEnabled:!0,description:"高速で経済的なチャットモデル"}],isEnabled:!0,requiresApiKey:!0,maxTokens:128e3,supportedFeatures:[{id:"text_generation",name:"テキスト生成",description:"自然言語でのテキスト生成",supported:!0},{id:"code_generation",name:"コード生成",description:"プログラムコード生成",supported:!0},{id:"image_analysis",name:"画像分析",description:"画像の理解と分析",supported:!0},{id:"function_calling",name:"関数呼び出し",description:"ツール・API呼び出し",supported:!0}],pricing:{inputTokenPrice:5e-6,outputTokenPrice:15e-6,currency:"USD"},status:"available",lastHealthCheck:new Date},{id:"anthropic",name:"Anthropic",displayName:"Anthropic",description:"安全性重視のAIアシスタント",models:[{id:"claude-3-5-sonnet",name:"Claude 3.5 Sonnet",displayName:"Claude 3.5 Sonnet",provider:"anthropic",contextLength:2e5,maxOutputTokens:8192,isMultimodal:!0,supportedLanguages:["ja","en","zh","ko","es","fr","de"],strengths:["推論","分析","安全性","長文理解"],useCase:["研究","分析","長文要約","コンサルティング"],pricing:{inputTokenPrice:3e-6,outputTokenPrice:15e-6},isEnabled:!0,description:"Anthropicの最新モデル"},{id:"claude-3-haiku",name:"Claude 3 Haiku",displayName:"Claude 3 Haiku",provider:"anthropic",contextLength:2e5,maxOutputTokens:4096,isMultimodal:!0,supportedLanguages:["ja","en","zh","ko"],strengths:["高速処理","経済性"],useCase:["チャット","簡単な作業","Q&A"],pricing:{inputTokenPrice:25e-8,outputTokenPrice:125e-8},isEnabled:!0,description:"高速で経済的なClaudeモデル"}],isEnabled:!0,requiresApiKey:!0,maxTokens:2e5,supportedFeatures:[{id:"text_generation",name:"テキスト生成",description:"自然言語でのテキスト生成",supported:!0},{id:"code_generation",name:"コード生成",description:"プログラムコード生成",supported:!0},{id:"image_analysis",name:"画像分析",description:"画像の理解と分析",supported:!0},{id:"document_analysis",name:"文書分析",description:"長文書の分析",supported:!0}],pricing:{inputTokenPrice:3e-6,outputTokenPrice:15e-6,currency:"USD"},status:"available",lastHealthCheck:new Date},{id:"google",name:"Google",displayName:"Google",description:"Googleの次世代AIモデル",models:[{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro",displayName:"Gemini 1.5 Pro",provider:"google",contextLength:2e6,maxOutputTokens:8192,isMultimodal:!0,supportedLanguages:["ja","en","zh","ko","es","fr","de","it"],strengths:["マルチモーダル","長文処理","検索連携"],useCase:["研究","分析","検索","マルチメディア"],pricing:{inputTokenPrice:125e-8,outputTokenPrice:5e-6},isEnabled:!0,description:"最大200万トークンの長文処理が可能"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash",displayName:"Gemini 1.5 Flash",provider:"google",contextLength:1e6,maxOutputTokens:8192,isMultimodal:!0,supportedLanguages:["ja","en","zh","ko"],strengths:["高速処理","経済性","マルチモーダル"],useCase:["チャット","リアルタイム処理"],pricing:{inputTokenPrice:75e-9,outputTokenPrice:3e-7},isEnabled:!0,description:"高速で経済的なGeminiモデル"}],isEnabled:!0,requiresApiKey:!0,maxTokens:2e6,supportedFeatures:[{id:"text_generation",name:"テキスト生成",description:"自然言語でのテキスト生成",supported:!0},{id:"code_generation",name:"コード生成",description:"プログラムコード生成",supported:!0},{id:"image_analysis",name:"画像分析",description:"画像の理解と分析",supported:!0},{id:"video_analysis",name:"動画分析",description:"動画の理解と分析",supported:!0},{id:"search_integration",name:"検索連携",description:"Google検索との連携",supported:!0}],pricing:{inputTokenPrice:125e-8,outputTokenPrice:5e-6,currency:"USD"},status:"available",lastHealthCheck:new Date}]}getAvailableProviders(){return this.providers.filter(e=>e.isEnabled)}getAvailableModels(){return this.providers.filter(e=>e.isEnabled).flatMap(e=>e.models.filter(e=>e.isEnabled))}getModelsByProvider(e){let t=this.providers.find(t=>t.id===e);return t?t.models.filter(e=>e.isEnabled):[]}async sendMessage(e,t,s){var a;let n=this.getAvailableModels().find(e=>e.id===t);if(!n)throw Error("Model ".concat(t," not found"));await new Promise(e=>setTimeout(e,1e3+2e3*Math.random()));let i=["".concat(n.displayName,"を使用した応答です。"),"こんにちは！".concat(n.displayName,"です。ご質問にお答えします。"),"".concat(n.provider,"の").concat(n.displayName,"による詳細な分析結果をお送りします。"),"".concat(n.displayName,"の強み（").concat(n.strengths.join("、"),"）を活用してお答えします。")],r={id:"msg-".concat(Date.now()),role:"assistant",content:i[Math.floor(Math.random()*i.length)]+'\n\n最後のメッセージ: "'.concat(null==(a=e[e.length-1])?void 0:a.content,'"'),timestamp:new Date,model:n.id,provider:n.provider,metadata:{tokenCount:Math.floor(500*Math.random())+100,responseTime:Math.floor(2e3*Math.random())+500,cost:.01*Math.random(),temperature:(null==s?void 0:s.temperature)||.7,maxTokens:(null==s?void 0:s.maxTokens)||1e3}};return this.updateUsageStats(n.provider,n.id,r.metadata),r}async sendMultiModelRequest(e){var t;let s=await Promise.all(e.models.map(async t=>{let s=this.getAvailableModels().find(e=>e.id===t);if(!s)return{model:t,provider:"unknown",content:"",metadata:{responseTime:0,tokenCount:0,cost:0},error:"Model ".concat(t," not found")};await new Promise(e=>setTimeout(e,2e3*Math.random()+500));let a=Math.floor(2e3*Math.random())+500,n=Math.floor(500*Math.random())+100,i=n*s.pricing.outputTokenPrice;return{model:s.id,provider:s.provider,content:"【".concat(s.displayName,"の応答】\n\n").concat(e.prompt,"について、").concat(s.displayName,"の観点からお答えします。\n\n私の強みは").concat(s.strengths.join("、"),"です。この質問に対して、").concat(s.useCase.join("、"),"の経験を活かして回答いたします。"),metadata:{responseTime:a,tokenCount:n,cost:i,confidence:.3*Math.random()+.7}}})),a=(null==(t=e.settings)?void 0:t.compareResponses)?this.generateComparison(e.prompt,s):void 0;return{requestId:"req-".concat(Date.now()),responses:s,comparison:a,totalCost:s.reduce((e,t)=>e+t.metadata.cost,0),totalResponseTime:Math.max(...s.map(e=>e.metadata.responseTime))}}async *streamResponse(e,t,s){let a=this.getAvailableModels().find(e=>e.id===t);if(!a)throw Error("Model ".concat(t," not found"));let n="".concat(a.displayName,"によるストリーミング応答です。この応答は段階的に配信されています。リアルタイムで応答が表示されることで、より自然な対話体験を提供します。").split("");for(let e=0;e<n.length;e++)await new Promise(e=>setTimeout(e,50+100*Math.random())),yield{id:"stream-".concat(Date.now(),"-").concat(e),delta:n[e],isComplete:e===n.length-1,metadata:{model:a.id,provider:a.provider,timestamp:new Date}}}generateComparison(e,t){let s={},a="",n=0;return t.forEach(e=>{if(e&&"object"==typeof e&&"model"in e){let t=30*Math.random()+70;s[e.model]=t,t>n&&(n=t,a=e.model)}}),{id:"comparison-".concat(Date.now()),prompt:e,responses:t.map(e=>e&&"object"==typeof e?{model:e.model||"unknown",provider:e.provider||"unknown",response:e.response,content:e.content,responseTime:e.responseTime||0,error:e.error,metadata:{tokenCount:0,cost:0,...e.metadata&&"object"==typeof e.metadata?e.metadata:{},quality:20*Math.random()+80,relevance:15*Math.random()+85,creativity:25*Math.random()+75}}:{model:"unknown",responseTime:0,metadata:{tokenCount:0,cost:0}}),analysis:{winner:a,scores:s,reasoning:"".concat(a,"が最も適切な応答を提供しました。品質、関連性、創造性の総合評価で優勝しています。"),criteria:["品質","関連性","創造性","有用性"]},timestamp:new Date}}updateUsageStats(e,t,s){let a=s&&"object"==typeof s?s:{},n=this.usageStats.find(s=>s.provider===e&&s.model===t&&"day"===s.period);n?(n.data.requests+=1,n.data.outputTokens+=a.tokenCount||0,n.data.cost+=a.cost||0,n.data.averageResponseTime=(n.data.averageResponseTime+(a.responseTime||0))/2):this.usageStats.push({provider:e,model:t,period:"day",data:{requests:1,inputTokens:0,outputTokens:a.tokenCount||0,cost:a.cost||0,averageResponseTime:a.responseTime||0,errorRate:0,successRate:100},timestamp:new Date})}getUsageStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"day";return this.usageStats.filter(t=>t.period===e)}getModelPerformanceMetrics(){return this.getAvailableModels().map(e=>({model:e.id,provider:e.provider,metrics:{averageResponseTime:1200+800*Math.random(),successRate:95+4*Math.random(),errorRate:2*Math.random(),averageTokensPerResponse:250+200*Math.random(),costEfficiency:20*Math.random()+80,userSatisfaction:10*Math.random()+90},benchmarks:{coding:20*Math.random()+80,reasoning:15*Math.random()+85,creativity:25*Math.random()+75,factualAccuracy:10*Math.random()+90,conversational:15*Math.random()+85},lastUpdated:new Date}))}async performHealthCheck(){for(let e of this.providers)try{await new Promise(e=>setTimeout(e,1e3*Math.random())),e.status=Math.random()>.1?"available":"rate_limited",e.lastHealthCheck=new Date}catch(t){e.status="error"}}setCurrentSession(e){this.currentSession=e}getCurrentSession(){return this.currentSession}recommendModel(e,t){let s=this.getAvailableModels();return"low"===t.budget?s.find(e=>e.pricing.outputTokenPrice<2e-6)||s[0]:"fast"===t.speed?s.find(e=>e.id.includes("flash")||e.id.includes("turbo"))||s[0]:"excellent"===t.quality&&s.find(e=>e.id.includes("gpt-4")||e.id.includes("claude-3.5"))||s[0]}getModelById(e){return this.getAvailableModels().find(t=>t.id===e)}constructor(){this.providers=[],this.currentSession=null,this.usageStats=[],this.initializeProviders()}}x.getInstance();let g={name:"Conea AI",model:"gpt-4o",system_prompt:"こんにちは！Conea AIです。何かお手伝いできることはありますか？",max_history:20,temperature:.7,max_tokens:1e3},y=e=>{let{agentConfig:t=g,onConfigChange:s,enableFileUpload:y=!0,enableSearch:f=!0,onGenerateWidget:w}=e,[b,v]=(0,n.useState)([{id:"1",text:t.system_prompt||"こんにちは！Conea AIです。何かお手伝いできることはありますか？",sender:"ai",timestamp:new Date,model:t.model}]),[j,N]=(0,n.useState)(""),[k,C]=(0,n.useState)(!1),[A,T]=(0,n.useState)("checking"),[M,P]=(0,n.useState)([]),[S,D]=(0,n.useState)(f),_=(0,n.useRef)(null),E=(0,n.useRef)(null),B=()=>{var e;null==(e=_.current)||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{B()},[b]),(0,n.useEffect)(()=>{(async()=>{T("checking");try{let e=x.getInstance().getAvailableModels();T(e.length>0?"connected":"disconnected")}catch(e){T("disconnected")}})()},[]);let I=async()=>{if(!j.trim()&&0===M.length||k)return;let e=j;if(M.length>0){let t=M.map(e=>e.name).join(", ");e=j+(j?"\n":"")+"[添付ファイル: ".concat(t,"]")}let s={id:Date.now().toString(),text:e,sender:"user",timestamp:new Date};v(e=>[...e,s]),[...M],N(""),P([]),C(!0);try{let s=x.getInstance(),a={prompt:e,models:[t.model||"gpt-4o"],temperature:t.temperature||.7,maxTokens:t.max_tokens||1e3,systemPrompt:t.system_prompt,streamResponse:!1,settings:{temperature:t.temperature||.7,maxTokens:t.max_tokens||1e3,stream:!1,compareResponses:!1}},n=await s.sendMultiModelRequest(a);if(n&&"responses"in n&&Array.isArray(n.responses)&&n.responses.length>0){let e=n.responses[0],t={id:(Date.now()+1).toString(),text:e.content||"エラーが発生しました",sender:"ai",timestamp:new Date,model:e.model};v(e=>[...e,t])}T("connected")}catch(s){console.error("Failed to send message:",s);let e="申し訳ありませんが、メッセージの送信に失敗しました。";s instanceof Error&&(e+=" (".concat(s.message,")"));let t={id:(Date.now()+1).toString(),text:e,sender:"ai",timestamp:new Date,error:!0};v(e=>[...e,t]),T("disconnected")}finally{C(!1)}},R=async()=>{T("checking");try{let e=x.getInstance().getAvailableModels();T(e.length>0?"connected":"disconnected")}catch(e){T("disconnected")}},L=e=>{P(t=>t.filter((t,s)=>s!==e))};return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-gray-900/50 backdrop-blur-lg rounded-xl border border-white/10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-[#1ABC9C] rounded-full flex items-center justify-center",children:(0,a.jsx)(o.A,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:t.name||"Conea AI"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("connected"===A?"bg-green-400":"disconnected"===A?"bg-red-400":"bg-yellow-400")}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"connected"===A?"オンライン":"disconnected"===A?"オフライン":"接続中..."}),t.model&&(0,a.jsx)("span",{className:"text-xs bg-white/10 px-2 py-1 rounded",children:t.model})]})]})]}),"disconnected"===A&&(0,a.jsx)("button",{onClick:R,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",title:"再接続",children:(0,a.jsx)(l.A,{className:"w-4 h-4 text-gray-400"})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4","data-testid":"chat-messages",children:[(0,a.jsx)(i.N,{children:b.map(e=>(0,a.jsx)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex ".concat("user"===e.sender?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-2 sm:space-x-3 max-w-[90%] sm:max-w-[80%] ".concat("user"===e.sender?"flex-row-reverse space-x-reverse":""),children:[(0,a.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full flex items-center justify-center flex-shrink-0 ".concat("user"===e.sender?"bg-[#3498DB]":"bg-[#1ABC9C]"),children:"user"===e.sender?(0,a.jsx)(d.A,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"}):(0,a.jsx)(o.A,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})}),(0,a.jsxs)("div",{className:"p-2 sm:p-3 rounded-lg ".concat("user"===e.sender?"bg-[#3498DB] text-white":"bg-white/10 text-white backdrop-blur-lg"),children:[(0,a.jsx)("p",{className:"text-sm sm:text-base",children:e.text}),(0,a.jsx)("p",{className:"text-xs opacity-70 mt-1",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},e.id))}),k&&(0,a.jsx)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-start",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-[#1ABC9C] rounded-full flex items-center justify-center",children:(0,a.jsx)(o.A,{className:"w-4 h-4 text-white"})}),(0,a.jsx)("div",{className:"bg-white/10 text-white backdrop-blur-lg p-3 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.A,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{className:"text-sm",children:"AIが考えています..."})]})})]})}),(0,a.jsx)("div",{ref:_})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-white/10",children:[M.length>0&&(0,a.jsx)("div",{className:"mb-3 flex flex-wrap gap-2",children:M.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-white/10 rounded-lg px-3 py-1",children:[(0,a.jsx)(m.A,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm text-white truncate max-w-[150px]",children:e.name}),(0,a.jsx)("button",{onClick:()=>L(t),className:"text-gray-400 hover:text-red-400 transition-colors",children:"\xd7"})]},t))}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[S&&(0,a.jsxs)("button",{className:"flex items-center space-x-1 px-2 py-1 bg-white/10 hover:bg-white/20 rounded text-xs transition-colors",title:"Search機能有効",children:[(0,a.jsx)(p.A,{className:"w-3 h-3 text-green-400"}),(0,a.jsx)("span",{className:"text-green-400",children:"Search ON"})]}),(0,a.jsxs)("button",{onClick:()=>{null==w||w({type:"chart",title:"AI生成グラフ",data:{chartType:"line",datasets:[{label:"売上推移",data:[65,59,80,81,56,55,40],backgroundColor:"#1ABC9C",borderColor:"#1ABC9C"}],labels:["1月","2月","3月","4月","5月","6月","7月"]},defaultSize:{width:6,height:4}});let e={id:(Date.now()+1).toString(),text:"売上推移のグラフを作成しました。右側のウィジェットライブラリにドラッグ可能なグラフが表示されています。",sender:"ai",timestamp:new Date,model:t.model};v(t=>[...t,e])},className:"flex items-center space-x-1 px-2 py-1 bg-[#1ABC9C]/20 hover:bg-[#1ABC9C]/30 rounded text-xs transition-colors",children:[(0,a.jsx)(h.A,{className:"w-3 h-3 text-[#1ABC9C]"}),(0,a.jsx)("span",{className:"text-[#1ABC9C]",children:"グラフ作成"})]})]}),(0,a.jsxs)("button",{onClick:()=>D(!S),className:"flex items-center space-x-1 px-2 py-1 rounded text-xs transition-colors ".concat(S?"bg-green-600/20 text-green-400":"bg-gray-600/20 text-gray-400"),children:[(0,a.jsx)(p.A,{className:"w-3 h-3"}),(0,a.jsxs)("span",{children:["Search ",S?"ON":"OFF"]})]})]}),(0,a.jsxs)("div",{className:"flex items-end space-x-3",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("textarea",{value:j,onChange:e=>N(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),I())},placeholder:"メッセージを入力してください...",className:"w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 pr-12 text-white placeholder-gray-400 resize-none focus:outline-none focus:ring-2 focus:ring-[#1ABC9C] backdrop-blur-lg",rows:1,style:{minHeight:"44px",maxHeight:"120px"},"data-testid":"chat-input"}),y&&(0,a.jsx)("button",{onClick:()=>{var e;return null==(e=E.current)?void 0:e.click()},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:(0,a.jsx)(m.A,{className:"w-4 h-4"})}),(0,a.jsx)("input",{ref:E,type:"file",multiple:!0,onChange:e=>{let t=Array.from(e.target.files||[]);P(e=>[...e,...t])},className:"hidden",accept:".txt,.pdf,.doc,.docx,.csv,.xlsx,.json"})]}),(0,a.jsx)("button",{onClick:I,disabled:!j.trim()||k,className:"bg-[#1ABC9C] hover:bg-[#16A085] disabled:bg-gray-600 disabled:cursor-not-allowed p-3 rounded-lg transition-colors","data-testid":"send-message-button",children:(0,a.jsx)(u.A,{className:"w-5 h-5 text-white"})})]})]})]})}}}]);