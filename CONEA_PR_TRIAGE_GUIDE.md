# Conea プロジェクト: PR トリアージ実施ガイド

**作成日**: 2025年5月21日  
**バージョン**: 1.0

## はじめに

このガイドは、Conea（旧Shopify MCP Server）プロジェクトにおけるプルリクエスト（PR）トリアージプロセスの標準化と効率化を目的としています。v0.3.0リリース後、v0.3.1に向けた開発を整理し、名称変更フェーズ2との整合性を確保するために、このプロセスを実施します。

## トリアージの目的

1. **未処理PRの整理**: オープン状態のPRを評価し、優先順位付け
2. **リソース最適化**: 限られた開発リソースを最も価値のある作業に集中
3. **名称変更との整合性**: フェーズ2実装に影響するPRを特定
4. **技術的負債の削減**: 長期間未対応のPRを処理
5. **透明性の確保**: 意思決定プロセスの明確化と文書化

## プロセスの概要

### 5月22日（準備フェーズ）
1. PR情報収集と分析
2. 評価基準の確認と環境設定
3. レビュー担当者の割り当て

### 5月23日（レビューフェーズ）
1. 各PRの技術レビュー実施
2. 依存関係分析
3. コンフリクト解決戦略の立案

### 5月24日（決定フェーズ）
1. トリアージミーティング（10:00-12:00）
2. カテゴリ分類と優先順位決定
3. 結果のドキュメント化と通知

## 具体的な実施手順

### 1. 環境セットアップ

```bash
# 1. 必要なツールのインストール
pip install PyGithub matplotlib networkx pandas numpy

# 2. リポジトリのクローンと更新
git clone https://github.com/mourigenta/conea.git
cd conea
git checkout develop
git pull origin develop

# 3. 環境変数の設定
export GITHUB_TOKEN=your_github_token_here

# 4. ディレクトリ構造の作成
mkdir -p triage/pr_reviews
mkdir -p triage/decisions
```

### 2. PR情報収集

```bash
# 1. PR情報の収集
python scripts/pr_inventory.py --repo mourigenta/conea --output triage/pr_inventory.json

# 2. 依存関係グラフの生成
python scripts/pr_dependency_graph.py --input triage/pr_inventory.json --output triage/pr_dependencies.png

# 3. 依存関係の分析
python scripts/analyze_pr_dependencies.py --input triage/pr_inventory.json --output triage/dependency_matrix.csv
```

### 3. レビュー実施

#### レビュー割り当て方法

1. **スキルマッチング**: 各PRの内容に最も適したスキルを持つ開発者を割り当て
2. **負荷分散**: 一人に集中しないよう、均等に分散
3. **クロスレビュー**: 少なくとも2名がレビューに参加

#### レビュー手順

1. PRをローカルにチェックアウト：
   ```bash
   git fetch origin pull/$PR_NUMBER/head:pr-$PR_NUMBER
   git checkout pr-$PR_NUMBER
   ```

2. コード変更の確認：
   ```bash
   git diff develop...HEAD
   ```

3. テストの実行：
   ```bash
   pytest
   ```

4. レビューテンプレートに従って評価：
   ```bash
   cp scripts/templates/pr_review_template.md triage/pr_reviews/pr-$PR_NUMBER-review.md
   # テンプレートに記入
   ```

### 4. 評価基準

各PRは以下の5つの観点で0-10点で評価されます：

1. **技術的価値** (0-10)
   - 10: コア機能への重要な貢献、パフォーマンス向上、セキュリティ強化
   - 5: 便利な機能追加、バグ修正、コード改善
   - 0: 技術的価値が低いまたは不明確

2. **緊急度** (0-10)
   - 10: リリースブロッカー、緊急性が高い問題の修正
   - 5: 重要だが緊急ではない
   - 0: 緊急性が低い

3. **複雑度** (0-10)
   - 10: 非常に複雑、大規模な変更
   - 5: 中程度の複雑さ
   - 0: 単純な変更

4. **依存関係** (0-10)
   - 10: 多くのPRをブロックしている、または多くのPRに依存している
   - 5: いくつかの依存関係がある
   - 0: 独立した変更

5. **名称変更への影響** (0-10)
   - 10: フェーズ2にクリティカルな影響がある
   - 5: フェーズ2に何らかの影響がある
   - 0: 名称変更とは無関係

### 5. カテゴリ分類

トリアージセッションでは、各PRを以下のカテゴリに分類します：

1. **A: 即時処理** (v0.3.1必須)
   - リリースに必須の機能
   - 多くのPRをブロックしている
   - 名称変更フェーズ2に不可欠

2. **B: 高優先度** (v0.3.1望ましい)
   - リリースに望ましい機能
   - 技術的価値が高い
   - 比較的独立している

3. **C: 中優先度** (v0.3.2候補)
   - 次のリリースサイクルに延期可能
   - 技術的価値はあるが緊急性に欠ける

4. **D: 低優先度** (将来検討/クローズ)
   - 価値が低いまたは不明確
   - 長期間更新がない
   - 他のPRで代替されている

### 6. トリアージセッションの進行

#### 事前準備

1. 全レビュワーがレビューを完了
2. 依存関係グラフと分析レポートを確認
3. 各PRのカテゴリ案を準備

#### セッション進行（10:00-12:00）

1. **イントロダクション** (10:00-10:10)
   - セッションの目的と進め方の説明
   - 全体状況の共有

2. **PR別レビュー** (10:10-11:20)
   - 各PRについて5-7分の議論
   - レビュワーからの報告（2分）
   - 質疑応答（2分）
   - カテゴリ提案（1分）

3. **カテゴリ分類決定** (11:20-11:50)
   - 全PRのカテゴリを決定
   - 各カテゴリ内での優先順位付け
   - 担当者と期限の設定

4. **まとめと次のステップ** (11:50-12:00)
   - 決定事項の確認
   - 次のアクションの確認

### 7. 結果のドキュメント化

トリアージ後は以下のドキュメントを作成します：

1. **PR決定記録**
   ```bash
   # 各PRの決定記録を作成
   cp scripts/templates/pr_triage_decision.md triage/decisions/pr-$PR_NUMBER-decision.md
   # 決定内容を記入
   ```

2. **トリアージ結果レポート**
   ```bash
   # 全体レポートの生成
   python scripts/generate_triage_report.py --decisions triage/decisions/ --output PR_TRIAGE_RESULTS.md
   ```

3. **GitHub更新**
   - PRにラベル付け（A/B/C/D分類に対応）
   - PRコメントに決定事項を投稿
   - 担当者と期限の設定

### 8. フォローアップ体制

1. **進捗確認**
   - デイリースタンドアップでのステータス報告
   - 週次レビューセッションの設定

2. **エスカレーションプロセス**
   - PRレビューが24時間以上滞った場合、技術リードに通知
   - ブロッカーが発生した場合、即時ミーティングを設定

3. **成功指標のモニタリング**
   - PRバックログ削減率
   - A・Bカテゴリの処理完了率
   - レビュー期間の短縮

## トリアージにおける重要な考慮事項

### 名称変更フェーズ2との関連性

フェーズ2（パッケージ名と内部モジュール構造の変更）に影響するPRは特に注意深く評価してください：

1. **直接的な影響**
   - パッケージ構造を変更するPR
   - インポート文を修正するPR
   - 設定ファイルを更新するPR

2. **間接的な影響**
   - テスト環境に影響するPR
   - ドキュメント参照を変更するPR
   - CI/CD設定を更新するPR

### 効率的なレビューのためのヒント

1. **焦点を絞る**
   - 全てを完璧にするよりも、主要な問題に集中
   - 名称変更への影響を特に注視

2. **建設的なフィードバック**
   - 問題点だけでなく解決策も提案
   - 強みも認識して伝える

3. **客観的な評価**
   - 個人的な好みではなく、プロジェクト全体の価値に基づいて判断
   - 評価基準に忠実に採点

## 付録：チェックリストとリファレンス

### トリアージ準備チェックリスト

- [ ] 全てのオープンPRを確認
- [ ] 必要なツールがインストールされている
- [ ] 環境変数が設定されている
- [ ] レビュワーが割り当てられている
- [ ] レビューテンプレートが用意されている

### トリアージセッションチェックリスト

- [ ] 全参加者がPR情報を事前確認
- [ ] 依存関係グラフが用意されている
- [ ] 各PRのレビューが完了している
- [ ] タイムキーパーが指定されている
- [ ] 記録担当者が指定されている

### ドキュメント化チェックリスト

- [ ] 各PRに決定記録が作成されている
- [ ] トリアージ結果レポートが生成されている
- [ ] GitHubのPRラベルが更新されている
- [ ] 担当者と期限が設定されている
- [ ] チームに結果が通知されている

## まとめ

このガイドに従ってPRトリアージを実施することで、Coneaプロジェクトの開発プロセスが効率化され、名称変更フェーズ2の円滑な実施に貢献します。明確な基準と透明性のあるプロセスにより、チーム全体が一貫した判断ができるようになります。

質問やフィードバックがあれば、プロジェクト技術リードまでお知らせください。