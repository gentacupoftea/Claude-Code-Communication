<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiLLM Demo - Conea</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .demo-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .api-status {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .provider-card {
            flex: 1;
            min-width: 250px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-healthy { background: #4caf50; }
        .status-unhealthy { background: #f44336; }
        .test-area {
            margin-top: 20px;
        }
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover:not(:disabled) {
            background: #1565c0;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .response-area {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 4px;
            min-height: 100px;
        }
        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }
        .api-key-section {
            background: #f0f4f8;
            border: 1px solid #d0d7de;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .api-key-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        .api-key-input label {
            min-width: 120px;
            font-weight: 500;
        }
        .api-key-input input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
        .api-key-input button {
            padding: 8px 16px;
            font-size: 14px;
        }
        .success-message {
            color: #4caf50;
            margin-top: 10px;
            display: none;
        }
        .error-message {
            color: #f44336;
            margin-top: 10px;
            display: none;
        }
        .toggle-visibility {
            background: #e0e0e0;
            color: #333;
            padding: 5px 10px;
            font-size: 12px;
            margin-left: 5px;
        }
        .toggle-visibility:hover:not(:disabled) {
            background: #d0d0d0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– MultiLLM Cloud System Demo</h1>
            <p>è¤‡æ•°ã®LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’çµ±åˆç®¡ç†ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</p>
        </div>

        <div class="disclaimer">
            <strong>âš ï¸ æ³¨æ„äº‹é …:</strong> ã“ã‚Œã¯å…¬é–‹ãƒ‡ãƒ¢ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã®ä½¿ç”¨ã¯æƒ³å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
            APIã«ã¯é©åˆ‡ãªãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
            <br><br>
            <strong>ğŸ“Œ ç¾åœ¨ã®çŠ¶æ³:</strong> ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã®ãŸã‚ã€APIã‚­ãƒ¼ã®è¨­å®šæ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™ã€‚
            å®Œå…¨ãªå‹•ä½œã«ã¯ã€Cloud Runç’°å¢ƒã§ã®APIã‚­ãƒ¼è¨­å®šãŒå¿…è¦ã§ã™ã€‚
        </div>

        <div class="demo-section api-key-section">
            <h2>ğŸ”‘ APIã‚­ãƒ¼è¨­å®š</h2>
            <p>å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚ã‚­ãƒ¼ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
            
            <div class="api-key-input">
                <label for="openai-key">OpenAI:</label>
                <input type="password" id="openai-key" placeholder="sk-...">
                <button class="toggle-visibility" onclick="toggleVisibility('openai-key')">è¡¨ç¤º</button>
            </div>
            
            <div class="api-key-input">
                <label for="anthropic-key">Anthropic:</label>
                <input type="password" id="anthropic-key" placeholder="sk-ant-...">
                <button class="toggle-visibility" onclick="toggleVisibility('anthropic-key')">è¡¨ç¤º</button>
            </div>
            
            <div class="api-key-input">
                <label for="google-key">Google AI:</label>
                <input type="password" id="google-key" placeholder="AIza...">
                <button class="toggle-visibility" onclick="toggleVisibility('google-key')">è¡¨ç¤º</button>
            </div>
            
            <button onclick="saveApiKeys()">APIã‚­ãƒ¼ã‚’ä¿å­˜</button>
            <button onclick="clearApiKeys()" style="background: #f44336;">APIã‚­ãƒ¼ã‚’ã‚¯ãƒªã‚¢</button>
            
            <div id="success-message" class="success-message">âœ… APIã‚­ãƒ¼ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ</div>
            <div id="error-message" class="error-message">âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>
        </div>

        <div class="demo-section">
            <h2>ğŸ” ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>
            <div class="api-status" id="api-status">
                <div class="provider-card">
                    <h3>OpenAI</h3>
                    <p><span class="status-indicator status-unhealthy"></span>æœªè¨­å®š</p>
                    <small>GPT-4, GPT-3.5</small>
                </div>
                <div class="provider-card">
                    <h3>Anthropic</h3>
                    <p><span class="status-indicator status-unhealthy"></span>æœªè¨­å®š</p>
                    <small>Claude 3 Opus, Sonnet</small>
                </div>
                <div class="provider-card">
                    <h3>Google AI</h3>
                    <p><span class="status-indicator status-unhealthy"></span>æœªè¨­å®š</p>
                    <small>Gemini 1.5 Flash, Pro</small>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>ğŸ§ª ãƒ†ã‚¹ãƒˆã‚¨ãƒªã‚¢</h2>
            <div class="test-area">
                <h3>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›</h3>
                <textarea id="prompt" rows="4" placeholder="ã“ã“ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...">Shopifyã®åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦ç°¡æ½”ã«èª¬æ˜ã—ã¦ãã ã•ã„ã€‚</textarea>
                
                <h3>æˆ¦ç•¥é¸æŠ</h3>
                <select id="strategy" style="padding: 8px; margin: 10px 0;">
                    <option value="quality">å“è³ªå„ªå…ˆ</option>
                    <option value="cost">ã‚³ã‚¹ãƒˆæœ€é©åŒ–</option>
                    <option value="speed">é€Ÿåº¦å„ªå…ˆ</option>
                </select>
                
                <div style="margin-top: 10px;">
                    <button id="testButton" onclick="testLLM()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <button id="healthButton" onclick="checkHealth()">ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</button>
                </div>
                
                <div class="response-area" id="response">
                    ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>ğŸ“Š API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</h2>
            <ul>
                <li><code>GET /api/llm/health</code> - ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</li>
                <li><code>POST /api/llm/generate</code> - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ</li>
                <li><code>POST /api/llm/stream</code> - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹</li>
                <li><code>GET /api/llm/providers</code> - åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ä¸€è¦§</li>
                <li><code>GET /api/llm/strategies</code> - åˆ©ç”¨å¯èƒ½ãªæˆ¦ç•¥ä¸€è¦§</li>
            </ul>
        </div>

        <div class="demo-section">
            <h2>ğŸ”§ ä½¿ç”¨æ–¹æ³•</h2>
            <ol>
                <li>ä¸Šéƒ¨ã®ã€ŒAPIã‚­ãƒ¼è¨­å®šã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®APIã‚­ãƒ¼ã‚’å…¥åŠ›</li>
                <li>ã€ŒAPIã‚­ãƒ¼ã‚’ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                <li>ã€Œãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€ãƒœã‚¿ãƒ³ã§æ¥ç¶šçŠ¶æ…‹ã‚’ç¢ºèª</li>
                <li>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ã€Œãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ã§MultiLLMã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ†ã‚¹ãƒˆ</li>
            </ol>
            <p><strong>æ³¨æ„:</strong> APIã‚­ãƒ¼ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã€ã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚</p>
        </div>
    </div>

    <script>
        const API_BASE = 'https://shopify-mcp-server-staging-259335331171.asia-northeast1.run.app';
        
        // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•°
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // APIã‚­ãƒ¼ã®ç®¡ç†
        function loadApiKeys() {
            document.getElementById('openai-key').value = localStorage.getItem('openai_api_key') || '';
            document.getElementById('anthropic-key').value = localStorage.getItem('anthropic_api_key') || '';
            document.getElementById('google-key').value = localStorage.getItem('google_api_key') || '';
        }
        
        function saveApiKeys() {
            const openaiKey = document.getElementById('openai-key').value.trim();
            const anthropicKey = document.getElementById('anthropic-key').value.trim();
            const googleKey = document.getElementById('google-key').value.trim();
            
            if (openaiKey) localStorage.setItem('openai_api_key', openaiKey);
            if (anthropicKey) localStorage.setItem('anthropic_api_key', anthropicKey);
            if (googleKey) localStorage.setItem('google_api_key', googleKey);
            
            // ã‚µãƒ¼ãƒãƒ¼ã«è¨­å®šã‚’é€ä¿¡
            updateServerApiKeys();
            
            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            const successMsg = document.getElementById('success-message');
            const errorMsg = document.getElementById('error-message');
            successMsg.style.display = 'block';
            errorMsg.style.display = 'none';
            
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
            
            // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
            checkHealth();
        }
        
        async function updateServerApiKeys() {
            const apiKeys = {
                openai: localStorage.getItem('openai_api_key'),
                anthropic: localStorage.getItem('anthropic_api_key'),
                google: localStorage.getItem('google_api_key')
            };
            
            try {
                await fetch(`${API_BASE}/api/settings/multillm`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ apiKeys })
                });
            } catch (error) {
                console.error('Failed to update server API keys:', error);
            }
        }
        
        function clearApiKeys() {
            localStorage.removeItem('openai_api_key');
            localStorage.removeItem('anthropic_api_key');
            localStorage.removeItem('google_api_key');
            
            document.getElementById('openai-key').value = '';
            document.getElementById('anthropic-key').value = '';
            document.getElementById('google-key').value = '';
            
            const successMsg = document.getElementById('success-message');
            const errorMsg = document.getElementById('error-message');
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            
            // ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚‚ã‚¯ãƒªã‚¢
            updateServerApiKeys();
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
            checkHealth();
        }
        
        function toggleVisibility(inputId) {
            const input = document.getElementById(inputId);
            const button = event.target;
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'éš ã™';
            } else {
                input.type = 'password';
                button.textContent = 'è¡¨ç¤º';
            }
        }
        
        // ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function setButtonsDisabled(disabled) {
            document.getElementById('testButton').disabled = disabled;
            document.getElementById('healthButton').disabled = disabled;
        }
        
        async function checkHealth() {
            const responseEl = document.getElementById('response');
            responseEl.textContent = 'ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ä¸­...';
            setButtonsDisabled(true);
            
            // APIã‚­ãƒ¼ã‚’é€ä¿¡
            await updateServerApiKeys();
            
            try {
                const response = await fetch(`${API_BASE}/api/llm/health`, {
                    headers: {
                        'X-API-Keys': JSON.stringify({
                            openai: localStorage.getItem('openai_api_key'),
                            anthropic: localStorage.getItem('anthropic_api_key'),
                            google: localStorage.getItem('google_api_key')
                        })
                    }
                });
                const data = await response.json();
                
                responseEl.innerHTML = `<pre>${escapeHtml(JSON.stringify(data, null, 2))}</pre>`;
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                updateStatus(data);
            } catch (error) {
                responseEl.textContent = `ã‚¨ãƒ©ãƒ¼: æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ`;
            } finally {
                setButtonsDisabled(false);
            }
        }
        
        async function testLLM() {
            const prompt = document.getElementById('prompt').value;
            const strategy = document.getElementById('strategy').value;
            const responseEl = document.getElementById('response');
            
            // å…¥åŠ›æ¤œè¨¼
            if (!prompt.trim()) {
                responseEl.textContent = 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                return;
            }
            
            if (prompt.length > 1000) {
                responseEl.textContent = 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯1000æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„';
                return;
            }
            
            responseEl.textContent = 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ä¸­...';
            setButtonsDisabled(true);
            
            try {
                const response = await fetch(`${API_BASE}/api/llm/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Keys': JSON.stringify({
                            openai: localStorage.getItem('openai_api_key'),
                            anthropic: localStorage.getItem('anthropic_api_key'),
                            google: localStorage.getItem('google_api_key')
                        })
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        strategy: strategy
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’é©ç”¨
                    const safeProvider = escapeHtml(data.data.provider);
                    const safeModel = escapeHtml(data.data.model);
                    const safeStrategy = escapeHtml(data.data.strategy);
                    const safeResponse = escapeHtml(data.data.response);
                    
                    responseEl.innerHTML = `
                        <strong>ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼:</strong> ${safeProvider}<br>
                        <strong>ãƒ¢ãƒ‡ãƒ«:</strong> ${safeModel}<br>
                        <strong>ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·:</strong> ${data.data.totalLatency}ms<br>
                        <strong>æˆ¦ç•¥:</strong> ${safeStrategy}<br>
                        <hr>
                        <strong>ãƒ¬ã‚¹ãƒãƒ³ã‚¹:</strong><br>
                        <pre style="white-space: pre-wrap;">${safeResponse}</pre>
                    `;
                } else {
                    responseEl.innerHTML = `
                        <strong style="color: #f44336;">ã‚¨ãƒ©ãƒ¼: ${escapeHtml(data.error || 'APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ')}</strong><br><br>
                        <strong>ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°:</strong><br>
                        1. APIã‚­ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„<br>
                        2. å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®APIã‚­ãƒ¼ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„<br>
                        3. ç¾åœ¨ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã¯Cloud Runç’°å¢ƒå¤‰æ•°ã®APIã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™<br>
                        <br>
                        <small>ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ${response.status}</small>
                    `;
                }
            } catch (error) {
                responseEl.textContent = `ã‚¨ãƒ©ãƒ¼: æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ`;
            } finally {
                setButtonsDisabled(false);
            }
        }
        
        function updateStatus(healthData) {
            const statusEl = document.getElementById('api-status');
            statusEl.innerHTML = healthData.providers.map(provider => {
                const safeName = escapeHtml(provider.provider.charAt(0).toUpperCase() + provider.provider.slice(1));
                const safeStatus = escapeHtml(provider.status);
                return `
                    <div class="provider-card">
                        <h3>${safeName}</h3>
                        <p>
                            <span class="status-indicator status-${safeStatus}"></span>
                            ${safeStatus === 'healthy' ? 'æ­£å¸¸' : 'æœªè¨­å®š'}
                        </p>
                        <small>ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: ${provider.metrics.totalRequests}</small>
                    </div>
                `;
            }).join('');
        }
        
        // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«APIã‚­ãƒ¼ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
        window.onload = () => {
            loadApiKeys();
            checkHealth();
        };
    </script>
</body>
</html>