# E2E Test Scenarios for Conea AI Platform MVP

## 概要

このドキュメントでは、Conea AI PlatformのMVPリリースに向けた包括的なE2Eテストシナリオを定義します。主要ユーザーストーリーを網羅し、クリティカルなバグの事前検出を目的としています。

## テストカバレッジ目標

- **主要ユーザーフロー**: 100%カバレッジ
- **エラーハンドリング**: 63シナリオ
- **ブラウザ対応**: Chrome、Firefox
- **テストケース総数**: 49件

## 1. 認証フロー (Authentication Flow)

### 1.1 ユーザー登録

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| 正常な登録 | 有効な情報で新規ユーザー登録 | アカウント作成成功、ダッシュボードへリダイレクト |
| フォームバリデーション | 必須フィールドの検証 | 適切なエラーメッセージ表示 |
| メール形式検証 | 無効なメール形式の入力 | メール形式エラー表示 |
| パスワード強度検証 | 弱いパスワードの入力 | パスワード強度警告表示 |
| パスワード確認 | パスワード不一致 | 確認パスワードエラー表示 |
| 重複メール検証 | 既存メールでの登録 | 重複エラーメッセージ表示 |
| 利用規約確認 | 利用規約未チェック | 利用規約エラー表示 |
| ネットワークエラー | 接続エラー時の処理 | ネットワークエラーメッセージ表示 |

### 1.2 ユーザーログイン

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| 正常なログイン | 有効な認証情報でログイン | ダッシュボードへリダイレクト |
| ログインフォーム表示 | ログインページの表示 | フォーム要素の正常表示 |
| 無効な認証情報 | 間違ったメール/パスワード | 認証エラーメッセージ表示 |
| ログアウト | ログアウト機能の動作 | ログインページへリダイレクト |
| 未認証アクセス制御 | 保護ページへの直接アクセス | ログインページへリダイレクト |
| トークン管理 | 認証トークンの保存・削除 | LocalStorage適切管理 |

## 2. ダッシュボード機能 (Dashboard Functionality)

### 2.1 データ表示

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| 初期データ読み込み | ダッシュボードの初期表示 | サマリーカード・チャート正常表示 |
| サマリー統計 | 売上・注文・AOV・CVR表示 | 正確な数値の表示 |
| トップ商品表示 | 売上上位商品リスト | 商品名・売上数の表示 |
| 最近の注文表示 | 最新注文リスト | 注文番号・顧客・金額表示 |
| 商品詳細ナビゲーション | 商品クリック時の遷移 | 商品詳細ページへの移動 |

### 2.2 データ操作

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| データリフレッシュ | 手動更新ボタン | 最新データの表示 |
| 日付範囲フィルタ | 期間指定でのデータ絞り込み | フィルタ適用後のデータ表示 |
| データ読み込みエラー | API障害時の処理 | エラーメッセージ・リトライボタン表示 |
| リトライ機能 | エラー後の再試行 | 正常データの復旧表示 |

## 3. マルチLLMチャット (MultiLLM Chat Interface)

### 3.1 基本チャット機能

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| チャット画面表示 | 初期画面の読み込み | チャット要素の正常表示 |
| OpenAIメッセージ送信 | OpenAIプロバイダーでの送信 | 適切なレスポンス受信 |
| Anthropicメッセージ送信 | Claudeプロバイダーでの送信 | 適切なレスポンス受信 |
| Googleメッセージ送信 | Geminiプロバイダーでの送信 | 適切なレスポンス受信 |
| チャット履歴表示 | 過去のメッセージ表示 | 時系列順での履歴表示 |

### 3.2 プロバイダー管理

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| プロバイダー切り替え | LLM提供者の変更 | 成功メッセージ・UI更新 |
| コンテキスト保持 | 切り替え時の会話継続 | 過去の文脈維持 |
| モデルパラメータ調整 | 温度・トークン数設定 | パラメータ反映確認 |
| システムプロンプト設定 | カスタムプロンプト入力 | プロンプト適用確認 |

### 3.3 エラーハンドリング

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| プロバイダーAPIエラー | API障害時の処理 | エラーメッセージ・代替提案 |
| レート制限エラー | 利用制限到達時 | 制限メッセージ・リトライタイマー |
| ストリーミング応答 | リアルタイム応答表示 | タイピング表示・段階的表示 |
| チャット履歴クリア | 履歴削除機能 | 履歴の完全削除確認 |
| チャットエクスポート | 履歴出力機能 | ダウンロード成功確認 |

## 4. プロジェクト管理 (Projects Management)

### 4.1 CRUD操作

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| プロジェクト一覧表示 | 既存プロジェクト表示 | 全プロジェクトの正常表示 |
| 新規プロジェクト作成 | プロジェクト新規作成 | 作成成功・リスト更新 |
| プロジェクト編集 | 既存プロジェクト更新 | 更新成功・内容反映 |
| プロジェクト削除 | プロジェクト削除 | 削除成功・リストから除去 |
| バリデーション | 必須項目・形式検証 | 適切なエラーメッセージ |

### 4.2 検索・フィルタリング

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| プロジェクト検索 | 名前・説明での検索 | 関連プロジェクトの表示 |
| ステータスフィルタ | アクティブ・非アクティブ絞り込み | フィルタ適用結果表示 |
| ソート機能 | 名前・日付でのソート | ソート順での表示 |
| ページネーション | 大量データの分割表示 | ページ切り替え・ナビゲーション |

### 4.3 一括操作

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| 複数選択 | チェックボックスでの選択 | 選択状態の正常管理 |
| 一括削除 | 複数プロジェクト削除 | 選択項目の一括削除 |
| 一括ステータス変更 | 複数項目の状態変更 | ステータス一括更新 |
| エクスポート | プロジェクトデータ出力 | CSV/JSON形式での出力 |

## 5. API設定管理 (API Settings Management)

### 5.1 APIキー管理

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| APIキー一覧表示 | 登録済みキー表示 | キー情報・ステータス表示 |
| OpenAI キー追加 | OpenAI APIキー登録 | 登録成功・接続テスト |
| Anthropic キー追加 | Claude APIキー登録 | 登録成功・接続テスト |
| Google キー追加 | Gemini APIキー登録 | 登録成功・接続テスト |
| キー形式バリデーション | 各プロバイダー形式検証 | 形式エラーメッセージ |

### 5.2 接続テスト

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| 有効キー接続テスト | 正常なAPIキーテスト | 接続成功・モデル情報表示 |
| 無効キー接続テスト | 無効なAPIキーテスト | 接続失敗・エラーメッセージ |
| 接続ステータス表示 | キーの接続状態表示 | 接続・未接続の正確な表示 |
| レート制限情報 | 利用制限情報表示 | 制限値・現在使用量表示 |

### 5.3 使用量管理

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| 使用統計表示 | リクエスト・トークン使用量 | 正確な使用量表示 |
| コスト計算 | 推定利用コスト表示 | コスト情報の表示 |
| アラート設定 | 制限超過時の警告 | アラートメッセージ表示 |
| キーローテーション | セキュリティ向上のための更新 | 安全なキー更新 |

## 6. キャッシュ管理 (Cache Management)

### 6.1 キャッシュ戦略

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| 初回データ取得 | APIからの初回データ取得 | データ取得・キャッシュ保存 |
| キャッシュからの読み込み | 保存済みデータの利用 | 高速データ表示 |
| キャッシュ期限切れ | TTL超過時の再取得 | 新しいデータの取得・更新 |
| 強制リフレッシュ | ユーザー指定での更新 | キャッシュ無視・最新データ取得 |

### 6.2 キャッシュ制御

| シナリオ | 説明 | 期待結果 |
|---------|------|---------|
| ログアウト時のクリア | 認証状態変更での削除 | 全キャッシュの削除 |
| エラー時のフォールバック | API障害時の対応 | キャッシュデータの表示・エラー通知 |
| リトライ機能 | エラー後の再試行 | 成功時のキャッシュ更新 |
| ストレージ管理 | ローカルストレージの適切な利用 | 容量制限・データ整合性 |

## エラーハンドリング総合シナリオ

### ネットワークエラー
- 接続タイムアウト
- DNS解決失敗
- サーバー応答なし
- 断続的な接続問題

### APIエラー
- 400番台クライアントエラー
- 500番台サーバーエラー
- レート制限超過
- 認証・認可失敗

### ユーザビリティエラー
- フォームバリデーション失敗
- 不正な入力値
- セッション期限切れ
- ブラウザ互換性問題

## テスト実行戦略

### スモークテスト
```bash
npm run test:e2e:smoke
```
- 認証フロー
- ダッシュボード基本表示

### 機能別テスト
```bash
npm run test:e2e:auth
npm run test:e2e:multillm
npm run test:e2e:projects
npm run test:e2e:api
npm run test:e2e:cache
```

### ブラウザ別テスト
```bash
npm run test:e2e:chrome
npm run test:e2e:firefox
```

### 全テスト実行
```bash
npm run test:e2e
```

## 成功基準

### 品質指標
- **テスト成功率**: 100%
- **カバレッジ**: 主要フロー100%
- **実行時間**: 15分以内
- **安定性**: 3回連続成功

### パフォーマンス基準
- **ページ読み込み**: 3秒以内
- **API応答**: 2秒以内
- **フォーム送信**: 1秒以内
- **エラーリカバリ**: 5秒以内

## リリース判定

以下の条件を満たした場合、MVPリリース承認適格と判定します：

1. ✅ 全テストケース（49件）が成功
2. ✅ エラーハンドリング（63シナリオ）が正常動作
3. ✅ マルチブラウザ対応確認完了
4. ✅ パフォーマンス基準をクリア
5. ✅ セキュリティ要件を満たす

---

このテストシナリオは、Conea AI PlatformのMVPリリースにおける品質保証の基盤となり、継続的な改善とユーザーエクスペリエンス向上に貢献します。